--================= TU·ª≤ CH·ªàNH NHANH =================
local allowedKeywords = { "Rare", "Common", "Epic", "Brainrot God", "Legendary", "Mythic", "Secret" }
local blacklistNames  = {
    ["Cocofanto Elefanto"] = true,
    ["Girafa Celestre"]    = true,
    ["Gattatino Nyanino"]  = true
}

local holdTime  = 3      -- gi·ªØ ph√≠m E bao l√¢u
local restTime  = 0      -- ngh·ªâ gi·ªØa c√°c l·∫ßn (hi·ªán ch∆∞a d√πng)
local checkInterval = 0.1
--===================================================

local Lighting       = game:GetService("Lighting")
local Players        = game:GetService("Players")
local RunService     = game:GetService("RunService")
local UserSettings   = UserSettings():GetService("UserGameSettings")
local VirtualInput   = game:GetService("VirtualInputManager")
local lp             = Players.LocalPlayer
local char           = lp.Character or lp.CharacterAdded:Wait()
local hrp            = char:WaitForChild("HumanoidRootPart")
local humanoid       = char:WaitForChild("Humanoid")

-- ‚ùå Gi·∫£m hi·ªáu ·ª©ng & FPS
pcall(function() game:GetService("StarterGui"):SetCoreGuiEnabled(Enum.CoreGuiType.All,false) end)
Lighting.GlobalShadows, Lighting.FogEnd, Lighting.Brightness = false, 1e6, 0
if workspace:FindFirstChildOfClass("Terrain") then
   local T = workspace:FindFirstChildOfClass("Terrain")
   T.WaterWaveSize, T.WaterWaveSpeed, T.WaterReflectance, T.WaterTransparency = 0, 0, 0, 1
end
local function stripEffects(obj)
   for _,v in pairs(obj:GetDescendants()) do
      if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Smoke") or v:IsA("Fire") then v.Enabled = false
      elseif v:IsA("PointLight") or v:IsA("SpotLight") or v:IsA("SurfaceLight") then v.Enabled = false
      elseif v:IsA("Decal") then v.Transparency = 1
      elseif v:IsA("Texture") then v:Destroy() end
   end
end
stripEffects(workspace)
workspace.DescendantAdded:Connect(function(o) task.wait(.1) pcall(stripEffects, o) end)
pcall(function() UserSettings.SavedQualityLevel = Enum.SavedQualitySetting.QualityLevel1 end)

-- üìå L∆∞u 6 ƒëi·ªÉm (1-4 v√πng, 5 nh√† m√¨nh, 6 c·ª≠a ƒë·ªãch)
local points, autoRunning = {}, false

-- ========== UI ==========
local gui = Instance.new("ScreenGui", game.CoreGui)
local frame = Instance.new("Frame", gui)
frame.Size, frame.Position = UDim2.new(0,220,0,330), UDim2.new(0.02,0,0.38,0)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.Active, frame.Draggable = true, true

local function makeBtn(text, y)
   local b = Instance.new("TextButton", frame)
   b.Size, b.Position = UDim2.new(1,-10,0,40), UDim2.new(0,5,0,y)
   b.Text, b.TextSize, b.Font = text, 18, Enum.Font.SourceSansBold
   b.BackgroundColor3, b.TextColor3 = Color3.fromRGB(60,60,60), Color3.new(1,1,1)
   return b
end

local btnP1 = makeBtn("L∆∞u g√≥c 1", 5)
local btnP2 = makeBtn("L∆∞u g√≥c 2", 50)
local btnP3 = makeBtn("L∆∞u g√≥c 3", 95)
local btnP4 = makeBtn("L∆∞u g√≥c 4", 140)
local btnP5 = makeBtn("L∆∞u nh√† m√¨nh", 185)
local btnP6 = makeBtn("L∆∞u c·ª≠a ƒë·ªãch", 230)
local btnRun = makeBtn("üöÄ B·∫Øt ƒê·∫ßu", 275)

local status = Instance.new("TextLabel", frame)
status.Size, status.Position = UDim2.new(1,0,0,25), UDim2.new(0,0,0,320)
status.BackgroundTransparency, status.TextColor3 = 1, Color3.new(1,1,0)
status.TextScaled, status.Text = true, "Ch∆∞a ch·∫°y"

local function setSaved(btn, label)
   btn.Text, btn.BackgroundColor3 = "‚úÖ " .. label, Color3.fromRGB(0,170,0)
end
btnP1.MouseButton1Click:Connect(function() points[1] = hrp.Position setSaved(btnP1,"G√≥c 1")  status.Text="‚úÖ ƒê√£ l∆∞u g√≥c 1" end)
btnP2.MouseButton1Click:Connect(function() points[2] = hrp.Position setSaved(btnP2,"G√≥c 2")  status.Text="‚úÖ ƒê√£ l∆∞u g√≥c 2" end)
btnP3.MouseButton1Click:Connect(function() points[3] = hrp.Position setSaved(btnP3,"G√≥c 3")  status.Text="‚úÖ ƒê√£ l∆∞u g√≥c 3" end)
btnP4.MouseButton1Click:Connect(function() points[4] = hrp.Position setSaved(btnP4,"G√≥c 4")  status.Text="‚úÖ ƒê√£ l∆∞u g√≥c 4" end)
btnP5.MouseButton1Click:Connect(function() points[5] = hrp.Position setSaved(btnP5,"Nh√†")    status.Text="‚úÖ ƒê√£ l∆∞u nh√†"   end)
btnP6.MouseButton1Click:Connect(function() points[6] = hrp.Position setSaved(btnP6,"C·ª≠a ƒë·ªãch") status.Text="‚úÖ ƒê√£ l∆∞u c·ª≠a ƒë·ªãch" end)

-- ========== H√ÄM PH·ª§ ==========
local function isInsideQuad(pos)
   if not (points[1] and points[2] and points[3] and points[4]) then return false end
   local function sign(p1,p2,p3) return (p1.X-p3.X)*(p2.Z-p3.Z)-(p2.X-p3.X)*(p1.Z-p3.Z) end
   local b1 = sign(pos, points[1], points[2]) < 0
   local b2 = sign(pos, points[2], points[3]) < 0
   local b3 = sign(pos, points[3], points[4]) < 0
   local b4 = sign(pos, points[4], points[1]) < 0
   return (b1 == b2) and (b2 == b3) and (b3 == b4)
end

local function isAllowedPet(name)
   if blacklistNames[name] then return false end
   for _, w in ipairs(allowedKeywords) do
      if name:lower():find(w:lower()) then return true end
   end
   return false
end

local function findClosestPet(retry)
   retry = retry or 0
   local validPets = {}

   for _, lbl in ipairs(workspace:GetDescendants()) do
      if lbl:IsA("TextLabel") then
         local name = lbl.Text
         if isAllowedPet(name) then
            local model = lbl:FindFirstAncestorOfClass("Model")
            local root  = model and model:FindFirstChildWhichIsA("BasePart")
            if model and root and isInsideQuad(root.Position) then
               table.insert(validPets, {model = model, root = root})
            end
         end
      end
   end

   if #validPets == 0 and retry < 5 then
      task.wait(0.2)
      return findClosestPet(retry + 1)
   end
   if #validPets > 0 then
      return validPets[math.random(1, #validPets)]
   end
   return nil
end

local function pressE(sec)
   VirtualInput:SendKeyEvent(true, Enum.KeyCode.E, false, game)
   task.wait(sec)
   VirtualInput:SendKeyEvent(false, Enum.KeyCode.E, false, game)
end

local function moveToPos(pos)
   local dest = Vector3.new(pos.X, hrp.Position.Y, pos.Z)
   humanoid:MoveTo(dest)
   local timeout = tick()
   repeat
      task.wait(0.05)
   until not autoRunning or (hrp.Position - dest).Magnitude <= 3 or tick() - timeout > 10
end

-- ========== CHU TR√åNH ƒÇN TR·ªòM ==========
local function stealCycle()
   while autoRunning do
      -- 1. t·ªõi c·ª≠a ƒë·ªãch
      status.Text = "üèÉ ƒê·∫øn c·ª≠a ƒë·ªãch"
      moveToPos(points[6])
      if not autoRunning then break end

      -- 2. qu√©t pet
      status.Text = "üîé Qu√©t pet"
      local pet = findClosestPet()
      if pet then
         status.Text = "üéØ Pet: " .. pet.model.Name

         -- 3. ch·∫°y t·ªõi pet
         moveToPos(pet.root.Position)
         if not autoRunning then break end

         -- 4. ki·ªÉm tra ƒë·ª©ng g·∫ßn r·ªìi m·ªõi gi·ªØ E
         if (hrp.Position - pet.root.Position).Magnitude <= 5 then
            status.Text = "üí∞ ƒÇn tr·ªôm..."
            task.wait(0.1)
            pressE(holdTime)
         else
            status.Text = "‚ö†Ô∏è L·ªách v·ªã tr√≠, b·ªè qua"
         end
      else
         status.Text = "üò¥ Kh√¥ng th·∫•y pet"
      end
      if not autoRunning then break end

      -- 5. quay l·∫°i c·ª≠a ƒë·ªãch
      status.Text = "‚Ü©Ô∏è V·ªÅ c·ª≠a ƒë·ªãch"
      moveToPos(points[6])
      if not autoRunning then break end

      -- 6. v·ªÅ nh√†
      status.Text = "üè° V·ªÅ nh√†"
      moveToPos(points[5])
   end
end

-- ========== N√öT B·∫ÆT ƒê·∫¶U ==========
btnRun.MouseButton1Click:Connect(function()
   for i = 1, 6 do
      if not points[i] then
         status.Text, status.TextColor3 = "‚ö†Ô∏è Thi·∫øu v·ªã tr√≠ " .. i, Color3.fromRGB(255,0,0)
         return
      end
   end

   autoRunning = not autoRunning
   btnRun.Text = autoRunning and "‚èπ D·ª´ng" or "üöÄ B·∫Øt ƒê·∫ßu"
   status.TextColor3 = Color3.fromRGB(0,200,255)
   status.Text = autoRunning and "üîÑ B·∫Øt ƒë·∫ßu..." or "ƒê√£ d·ª´ng"

   if autoRunning then
      task.spawn(stealCycle)
   end
end)

-- Gi·ªØ script s·ªëng
while true do task.wait(1) end
