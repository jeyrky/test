-- üîÅ AUTO JOIN / REJOIN VIP SERVER (NO BUTTON)
if not game:IsLoaded() then game.Loaded:Wait() end

local Players  = game:GetService("Players")
local TS       = game:GetService("TeleportService")
local CoreGui  = game:GetService("CoreGui")
local lp       = Players.LocalPlayer

-- === ƒêI·ªÄN LINK VIP SERVER T·∫†I ƒê√ÇY ===
local VIP_URL = "https://www.roblox.com/games/109983668079237/Steal-a-Brainrot?privateServerLinkCode=47610790923029385168357298494861"

-- L·∫•y PlaceId v√† Code t·ª´ link
local function parseVip(url)
    if type(url) ~= "string" then return nil, nil end
    local placeStr = url:match("/games/(%d+)/")
    local code = url:match("[?&]privateServerLinkCode=([%w_%-]+)")
    local placeId = placeStr and tonumber(placeStr) or nil
    return placeId, code
end

local PLACE_ID, VIP_CODE = parseVip(VIP_URL)
if not PLACE_ID or not VIP_CODE or VIP_CODE == "" then
    warn("[VIP Join] URL kh√¥ng h·ª£p l·ªá. Ki·ªÉm tra l·∫°i VIP_URL!")
    return
end

local REJOINING = false
local MAX_RETRIES = 6

local function joinVip()
    if REJOINING then return end
    REJOINING = true
    for i = 1, MAX_RETRIES do
        local ok, err = pcall(function()
            TS:TeleportToPrivateServer(PLACE_ID, VIP_CODE, { lp })
        end)
        if ok then return end
        warn(("[VIP Join] L·ªói %d/%d: %s"):format(i, MAX_RETRIES, tostring(err)))
        task.wait(0.8 + (i-1)*0.5)
    end
    REJOINING = false
end

-- V√†o l·∫°i ngay khi load script
task.spawn(joinVip)

-- Auto rejoin khi b·ªã disconnect/kick/error
do
    local function hookPrompt(container)
        container.DescendantAdded:Connect(function(d)
            if typeof(d) ~= "Instance" then return end
            local name = string.lower(d.Name or "")
            if name:find("errorprompt") then
                task.wait(0.4); joinVip(); return
            end
            if d:IsA("TextLabel") then
                local t = string.lower(d.Text or "")
                if t:find("disconnected") or t:find("kicked") or t:find("unexpected")
                   or (t:find("server") and t:find("closing")) then
                    task.wait(0.4); joinVip()
                end
            end
        end)
    end
    local function tryHookNow()
        local p = CoreGui:FindFirstChild("RobloxPromptGui", true)
        if p then hookPrompt(p) end
    end
    tryHookNow()
    CoreGui.ChildAdded:Connect(function(ch)
        if ch.Name == "RobloxPromptGui" then
            task.wait(0.1); tryHookNow()
        end
    end)
end

-- Retry khi teleport fail
TS.TeleportInitFailed:Connect(function(_, result)
    warn("[VIP Join] TeleportInitFailed:", result)
    task.wait(0.6)
    joinVip()
end)

print(string.format("[VIP Join] ƒêang k·∫øt n·ªëi t·ªõi VIP: PlaceId=%s, Code=%s", tostring(PLACE_ID), tostring(VIP_CODE)))
