-- üîÅ AUTO RECONNECT SAME SERVER (no Kick, mobile-friendly)
local TS         = game:GetService("TeleportService")
local Players    = game:GetService("Players")
local CoreGui    = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local lp         = Players.LocalPlayer

-- ===== C·∫§U H√åNH =====
local CFG = {
    PERIODIC_REJOIN_SEC  = 60,    -- m·ªói 60s t·ª± ‚Äúk·∫øt n·ªëi l·∫°i‚Äù
    MAX_RETRIES          = 6,     -- th·ª≠ l·∫°i teleport t·ªëi ƒëa
    RETRY_BACKOFF_BASE   = 0.8,   -- gi√¢y; tƒÉng d·∫ßn m·ªói l·∫ßn fail
    WATCHDOG             = true,  -- treo heartbeat -> t·ª± v√†o l·∫°i
    STALL_SECONDS        = 12,
    CHECK_INTERVAL       = 2,
    SAME_SERVER_FIRST    = true,  -- ∆∞u ti√™n v√†o l·∫°i ƒë√∫ng JobId
}

local REJOINING = false

local function rejoinSameOrNew()
    if REJOINING then return end
    REJOINING = true

    -- lu√¥n l·∫•y PlaceId/JobId M·ªöI NH·∫§T ngay l√∫c g·ªçi (ph√≤ng server restart ƒë·ªïi JobId)
    local PLACE_ID = game.PlaceId
    local JOB_ID   = game.JobId

    -- th·ª≠ v√†o l·∫°i ƒë√∫ng JobId tr∆∞·ªõc
    if CFG.SAME_SERVER_FIRST and JOB_ID and JOB_ID ~= "" then
        for i = 1, CFG.MAX_RETRIES do
            local ok, err = pcall(function()
                TS:TeleportToPlaceInstance(PLACE_ID, JOB_ID, lp)
            end)
            if ok then return end
            warn(("[Reconnect] Same JobId fail %d/%d: %s"):format(i, CFG.MAX_RETRIES, tostring(err)))
            task.wait(CFG.RETRY_BACKOFF_BASE + (i-1)*0.5)
        end
    end

    -- fallback: v√†o PlaceId (server m·ªõi) n·∫øu server c≈© ƒë√≥ng/full
    for i = 1, CFG.MAX_RETRIES do
        local ok, err = pcall(function()
            TS:Teleport(PLACE_ID, lp)
        end)
        if ok then return end
        warn(("[Reconnect] Place-only fail %d/%d: %s"):format(i, CFG.MAX_RETRIES, tostring(err)))
        task.wait(CFG.RETRY_BACKOFF_BASE + (i-1)*0.5)
    end

    REJOINING = false
end

-- üîî B·∫Øt ErrorPrompt (Disconnected/Kicked/Unexpected Error) -> t·ª± v√†o l·∫°i
do
    local function hookPrompt(container)
     
