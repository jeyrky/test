local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local humanoid = char:WaitForChild("Humanoid")

local holdTime = 3
local followDistance = 1.2
local checkInterval = 0.2
local allowedKeywords = { "Rare" }

-- âœ… VÃ™NG GIá»šI Háº N (tháº£m Ä‘á»)
local startPos = Vector3.new(-410.59, -6.5, -134.74)
local endPos = Vector3.new(-408.79, -6.5, 255.76)
local autoRunning = false

-- GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoPET_GUI"
screenGui.ResetOnSpawn = false
task.spawn(function()
	repeat wait() until lp:FindFirstChild("PlayerGui")
	screenGui.Parent = lp:WaitForChild("PlayerGui")
end)

local function createButton(text, posY)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, 220, 0, 40)
	btn.Position = UDim2.new(0, 10, 0, posY)
	btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.Text = text
	btn.Parent = screenGui
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 20
	btn.BorderSizePixel = 0
	return btn
end

local startBtn = createButton("â–¶ï¸ Báº¯t Ä‘áº§u", 100)

-- Kiá»ƒm tra tÃªn PET
local function isAllowedPet(name)
	for _, word in ipairs(allowedKeywords) do
		if string.lower(name):find(string.lower(word)) then
			return true
		end
	end
	return false
end

-- ðŸ“ Kiá»ƒm tra vá»‹ trÃ­ cÃ³ náº±m trong vÃ¹ng giá»›i háº¡n khÃ´ng
local function isInZone(pos)
	local minX, maxX = math.min(startPos.X, endPos.X), math.max(startPos.X, endPos.X)
	local minZ, maxZ = math.min(startPos.Z, endPos.Z), math.max(startPos.Z, endPos.Z)
	return pos.X >= minX and pos.X <= maxX and pos.Z >= minZ and pos.Z <= maxZ
end

-- Mua PET (chá»‰ náº¿u PET trong vÃ¹ng)
local function holdEOnPet(pet)
	local root = pet.root
	local model = pet.model
	if not root or not model:IsDescendantOf(workspace) then return end
	if not isInZone(root.Position) then
		print("âš ï¸ PET náº±m ngoÃ i vÃ¹ng tháº£m Ä‘á» â†’ Bá» qua")
		return
	end

	print("ðŸŽ¯ Mua PET:", model.Name)

	local prompt = model:FindFirstChildOfClass("ProximityPrompt") or root:FindFirstChildOfClass("ProximityPrompt")
	if prompt then
		fireproximityprompt(prompt)
		print("âœ… ÄÃ£ fire prompt")
		return
	end

	-- DÃ¹ng keypress náº¿u khÃ´ng cÃ³ prompt
	pcall(function() keypress(0x45) end)
	local start = tick()

	local followConn = RunService.RenderStepped:Connect(function()
		-- KhÃ´ng cho ra khá»i vÃ¹ng Ä‘á»
		if not isInZone(root.Position) then
			humanoid:MoveTo(hrp.Position) -- Ä‘á»©ng im
			return
		end

		if (hrp.Position - root.Position).Magnitude > followDistance then
			humanoid:MoveTo(Vector3.new(root.Position.X, hrp.Position.Y, root.Position.Z))
		else
			humanoid:MoveTo(hrp.Position)
		end
	end)

	while tick() - start < holdTime do
		if not model:IsDescendantOf(workspace) or not isInZone(root.Position) then break end
		wait(0.1)
	end

	pcall(function() keyrelease(0x45) end)
	if followConn then followConn:Disconnect() end

	print("âœ… ÄÃ£ thá»­ mua PET")
end

-- TÃ¬m PET há»£p lá»‡ gáº§n nháº¥t trong vÃ¹ng Ä‘á»
local function findClosestPet()
	local nearest, nearestDist = nil, math.huge
	for _, label in ipairs(workspace:GetDescendants()) do
		if label:IsA("TextLabel") and isAllowedPet(label.Text) then
			local model = label:FindFirstAncestorOfClass("Model")
			local root = model and model:FindFirstChildWhichIsA("BasePart")
			if root and model:IsDescendantOf(workspace) and isInZone(root.Position) then
				local dist = (hrp.Position - root.Position).Magnitude
				if dist < nearestDist then
					nearest = { model = model, root = root }
					nearestDist = dist
				end
			end
		end
	end

	if nearest then
		print("ðŸ‘€ PET gáº§n nháº¥t:", nearest.model.Name)
	else
		print("âŒ KhÃ´ng tÃ¬m tháº¥y PET trong vÃ¹ng")
	end

	return nearest
end

-- VÃ²ng láº·p chÃ­nh
task.spawn(function()
	while true do
		wait(checkInterval)
		if autoRunning then
			local pet = findClosestPet()
			if pet then holdEOnPet(pet) end
		end
	end
end)

-- GÃ¡n nÃºt cháº¡y
startBtn.MouseButton1Click:Connect(function()
	autoRunning = not autoRunning
	startBtn.Text = autoRunning and "â¹ Äang cháº¡y..." or "â–¶ï¸ Báº¯t Ä‘áº§u"
end)
