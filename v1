local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local humanoid = char:WaitForChild("Humanoid")

local holdTime = 4
local followDistance = 1.2
local checkInterval = 0.2
local autoRunning = false

-- Tá»a Ä‘á»™ máº·c Ä‘á»‹nh vÃ¹ng tháº£m Ä‘á»
local startPos = Vector3.new(-410.59, -6.50, -134.74)
local endPos = Vector3.new(-408.79, -6.50, 255.76)

-- CÃ¡c loáº¡i pet cáº§n sÄƒn (chá»¯ thÆ°á»ng)
local petTypes = {
	"secret",
	"mythic",
	"mythical",
	"Legendary"
}

-- Táº¡o giao diá»‡n
local screenGui = Instance.new("ScreenGui", game.CoreGui)
screenGui.Name = "AutoPET_GUI"

local function createButton(text, posY)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, 220, 0, 40)
	btn.Position = UDim2.new(0, 10, 0, posY)
	btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.Text = text
	btn.Parent = screenGui
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 20
	btn.BorderSizePixel = 0
	return btn
end

local startBtn = createButton("â–¶ï¸ Báº¯t Ä‘áº§u", 100)
local setStartBtn = createButton("ğŸ“ LÆ°u tá»a Ä‘á»™ Ä‘áº§u", 150)
local setEndBtn = createButton("ğŸ“ LÆ°u tá»a Ä‘á»™ cuá»‘i", 200)

-- Giá»¯ phÃ­m E trÃªn pet Ä‘á»ƒ mua (Ä‘Ã£ sá»­a thÃ nh tá»± cháº¡y tá»›i pet rá»“i má»›i mua)
local function holdEOnPet(pet)
	local root = pet.root
	local model = pet.model
	if not root or not model:IsDescendantOf(workspace) then return end

	local owner = model:FindFirstChild("Owner")
	if owner and owner:IsA("ObjectValue") and owner.Value and owner.Value ~= lp then
		return
	end

	local cash = lp:FindFirstChild("leaderstats") and lp.leaderstats:FindFirstChild("Cash")
	if not cash then return end

	-- Cháº¡y Ä‘áº¿n PET trÆ°á»›c khi mua
	humanoid:MoveTo(Vector3.new(root.Position.X, hrp.Position.Y, root.Position.Z))

	local reached = false
	local timeWaited = 0
	repeat
		task.wait(0.1)
		timeWaited += 0.1
		if (hrp.Position - root.Position).Magnitude <= 2 then
			reached = true
		end
	until reached or timeWaited >= 5 or not autoRunning

	if not reached then
		print("âŒ KhÃ´ng tiáº¿p cáº­n Ä‘Æ°á»£c PET:", model.Name)
		return
	end

	local cashBefore = cash.Value
	keypress(0x45)

	local holdStart = tick()
	while tick() - holdStart < holdTime and model:IsDescendantOf(workspace) do
		task.wait(0.1)
	end

	keyrelease(0x45)

	local cashAfter = cash.Value
	if cashAfter < cashBefore then
		print("âœ… MUA PET thÃ nh cÃ´ng:", model.Name)
	else
		print("âŒ KhÃ´ng mua Ä‘Æ°á»£c:", model.Name)
	end
end

-- Kiá»ƒm tra trong vÃ¹ng
local function isInZone(pos)
	local minX, maxX = math.min(startPos.X, endPos.X), math.max(startPos.X, endPos.X)
	local minZ, maxZ = math.min(startPos.Z, endPos.Z), math.max(startPos.Z, endPos.Z)
	return pos.X >= minX and pos.X <= maxX and pos.Z >= minZ and pos.Z <= maxZ
end

-- Kiá»ƒm tra tÃªn chá»©a loáº¡i pet mong muá»‘n
local function containsPetType(text)
	local lowerText = string.lower(text)
	for _, petType in ipairs(petTypes) do
		if string.find(lowerText, petType) then
			return true
		end
	end
	return false
end

-- TÃ¬m PET gáº§n nháº¥t phÃ¹ há»£p
local function findClosestPet()
	local nearest, nearestDist = nil, math.huge
	for _, label in ipairs(workspace:GetDescendants()) do
		if label:IsA("TextLabel") and containsPetType(label.Text) then
			local model = label:FindFirstAncestorOfClass("Model")
			local root = model and model:FindFirstChildWhichIsA("BasePart")
			if root and model:IsDescendantOf(workspace) and isInZone(root.Position) then
				local dist = (hrp.Position - root.Position).Magnitude
				if dist < nearestDist then
					nearest = { model = model, root = root }
					nearestDist = dist
				end
			end
		end
	end
	return nearest
end

-- Auto loop
task.spawn(function()
	while true do
		task.wait(checkInterval)
		if autoRunning then
			local pet = findClosestPet()
			if pet then
				holdEOnPet(pet)
			end
		end
	end
end)

-- NÃºt: LÆ°u tá»a Ä‘á»™ Ä‘áº§u
setStartBtn.MouseButton1Click:Connect(function()
	startPos = hrp.Position
	setStartBtn.Text = "âœ… ÄÃ£ lÆ°u tá»a Ä‘á»™ Ä‘áº§u"
end)

-- NÃºt: LÆ°u tá»a Ä‘á»™ cuá»‘i
setEndBtn.MouseButton1Click:Connect(function()
	endPos = hrp.Position
	setEndBtn.Text = "âœ… ÄÃ£ lÆ°u tá»a Ä‘á»™ cuá»‘i"
end)

-- NÃºt: Báº¯t Ä‘áº§u
startBtn.MouseButton1Click:Connect(function()
	if not startPos or not endPos then
		warn("âš ï¸ startPos hoáº·c endPos chÆ°a Ä‘Æ°á»£c gÃ¡n.")
		return
	end

	autoRunning = not autoRunning
	if autoRunning then
		startBtn.Text = "â¹ Äang cháº¡y..."
		print("âœ… Auto Ä‘ang cháº¡y...")

		-- Cháº¡y Ä‘áº¿n Ä‘iá»ƒm báº¯t Ä‘áº§u
		humanoid:MoveTo(Vector3.new(startPos.X, hrp.Position.Y, startPos.Z))

		local timeWaited = 0
		local reached = false
		repeat
			task.wait(0.1)
			timeWaited += 0.1
			if (hrp.Position - startPos).Magnitude <= 3 then
				reached = true
				break
			end
		until timeWaited >= 5 or not autoRunning

		if reached then
			print("ğŸ•’ ÄÃ£ Ä‘áº¿n Ä‘iá»ƒm báº¯t Ä‘áº§u, báº¯t Ä‘áº§u sÄƒn pet...")
		else
			print("âš ï¸ KhÃ´ng Ä‘áº¿n Ä‘Æ°á»£c Ä‘iá»ƒm báº¯t Ä‘áº§u sau 5 giÃ¢y, váº«n tiáº¿p tá»¥c...")
		end
	else
		startBtn.Text = "â–¶ï¸ Báº¯t Ä‘áº§u"
		print("â¹ Auto Ä‘Ã£ táº¯t.")
	end
end)
